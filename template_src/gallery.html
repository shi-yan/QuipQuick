<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!-- Primary Meta Tags -->
    <title>{{blog_title}}</title>
    <meta name="title" content="{{blog_title}}" />
    <meta name="description" content="{{blog_description}}" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="{{blog_url}}" />
    <meta property="og:title" content="{{blog_title}}" />
    <meta property="og:description" content="{{blog_description}}" />
    {{#if logo}}
    <meta property="og:image" content="{{blog_url}}/{{logo}}" />
    {{/if}}

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content="{{blog_url}}" />
    <meta property="twitter:title" content="{{blog_title}}" />
    <meta property="twitter:description" content="{{blog_description}}" />
    {{#if logo}}
    <meta property="twitter:image" content="{{blog_url}}/{{logo}}" />
    {{/if}}
    <link rel="alternate" type="application/rss+xml" title="{{blog_title}}" href="{{blog_url}}/rss.xml" />

    <link rel="stylesheet" href="/style.css" />

    <script src="
        https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.js
        "></script>
    <link href="
        https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css
        " rel="stylesheet" />
</head>

<body>
    <div id="page">
        <div id="header"></div>
        <div id="left"></div>
        <div class="content">
            <div class="blog-title">
                <a class="blog-title" href="/index.html">{{blog_title}}</a> <a class="icon" href="{{repo}}"
                    target="_blank"><svg xmlns="http://www.w3.org/2000/svg" height="32" width="32" fill="#dadadb"
                        viewBox="0 0 480 512">
                        <path
                            d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z" />
                    </svg></a>
                <a class="icon" href="{{blog_url}}/rss.xml" target="_blank"><svg xmlns="http://www.w3.org/2000/svg"
                        height="32" width="32" fill="#dadadb" viewBox="0 0 448 512">
                        <path
                            d="M0 64C0 46.3 14.3 32 32 32c229.8 0 416 186.2 416 416c0 17.7-14.3 32-32 32s-32-14.3-32-32C384 253.6 226.4 96 32 96C14.3 96 0 81.7 0 64zM0 416a64 64 0 1 1 128 0A64 64 0 1 1 0 416zM32 160c159.1 0 288 128.9 288 288c0 17.7-14.3 32-32 32s-32-14.3-32-32c0-123.7-100.3-224-224-224c-17.7 0-32-14.3-32-32s14.3-32 32-32z" />
                    </svg>
                </a>
                <p class="blog-description">{{blog_description}}</p>
            </div>

            <h3 class="gallery-title">{{gallery_title}}</h3>
            <p class="gallery-description">{{gallery_description}}</p>

            <div class="gallery">
                {{#each images}}
                <div class="gallery-item" data-video-src="{{file}}" data-video-title="{{title}}">
                    <div class="gallery-video-container">
                        <img class="gallery-video-preview" src="{{preview}}" alt="{{title}}" title="{{title}}" 
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                        <video class="gallery-video-fallback" title="{{title}}" webkit-playsinline="true" playsinline="true"
                            muted="muted" src="{{file}}" preload="metadata" style="display:none;"></video>
                        <div class="gallery-video-overlay">
                            <div class="gallery-play-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M8 5v14l11-7z"/>
                                </svg>
                            </div>
                            <div class="gallery-video-indicator">VIDEO</div>
                        </div>
                    </div>
                    <div class="gallery-item-title">{{title}}</div>
                </div>
                {{/each}}
            </div>

            <!-- Video Modal -->
            <div id="video-modal" class="video-modal">
                <div class="video-modal-content">
                    <div class="video-modal-header">
                        <h3 id="video-modal-title"></h3>
                        <button class="video-modal-close">&times;</button>
                    </div>
                    <div class="video-modal-player">
                        <video id="modal-video" webkit-playsinline="true" playsinline="true" controls></video>
                        <div class="video-loading">Loading...</div>
                    </div>
                </div>
            </div>

        </div>
        <div id="right"></div>
        <div id="footer">Generated by <a class="link" href="https://github.com/shi-yan/QuipQuick"
                target="_blank">QuipQuick</a> @</div>
        <script type="module">
            async function setBuildTime() {
                let response = await fetch("/current_time.txt");
                let currentTime = await response.text();
                document.getElementById('footer').innerHTML += ' ' + currentTime;
            }
            setBuildTime();

            // Video Modal functionality
            const videoModal = document.getElementById('video-modal');
            const modalVideo = document.getElementById('modal-video');
            const modalTitle = document.getElementById('video-modal-title');
            const modalClose = document.querySelector('.video-modal-close');
            const videoLoading = document.querySelector('.video-loading');
            const galleryItems = document.querySelectorAll('.gallery-item');

            console.log('Gallery items found:', galleryItems.length);
            console.log('Modal elements:', { videoModal, modalVideo, modalTitle, modalClose, videoLoading });

            // Open modal when gallery item is clicked
            galleryItems.forEach((item, index) => {
                console.log(`Setting up click handler for item ${index}`);
                item.addEventListener('click', (e) => {
                    console.log('Gallery item clicked:', item);
                    e.preventDefault();
                    
                    const videoSrc = item.getAttribute('data-video-src');
                    const videoTitle = item.getAttribute('data-video-title');
                    
                    console.log('Opening modal with:', { videoSrc, videoTitle });
                    
                    if (videoModal && modalTitle && modalVideo) {
                        modalTitle.textContent = videoTitle || 'Video';
                        videoLoading.style.display = 'block';
                        videoModal.style.display = 'block';
                        document.body.style.overflow = 'hidden';
                        
                        // Load video
                        modalVideo.src = videoSrc;
                        modalVideo.addEventListener('loadeddata', function onLoad() {
                            videoLoading.style.display = 'none';
                            modalVideo.removeEventListener('loadeddata', onLoad);
                        });
                        
                        // Fallback in case loadeddata doesn't fire
                        setTimeout(() => {
                            if (videoLoading.style.display !== 'none') {
                                videoLoading.style.display = 'none';
                            }
                        }, 3000);
                    }
                });
            });

            // Close modal functions
            function closeModal() {
                videoModal.style.display = 'none';
                modalVideo.pause();
                modalVideo.src = '';
                document.body.style.overflow = 'auto'; // Restore scrolling
                videoLoading.style.display = 'block';
            }

            // Close modal when close button is clicked
            modalClose.addEventListener('click', closeModal);

            // Close modal when clicking outside the content
            videoModal.addEventListener('click', (e) => {
                if (e.target === videoModal) {
                    closeModal();
                }
            });

            // Close modal with Escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && videoModal.style.display === 'block') {
                    closeModal();
                }
            });

            // Prevent modal content clicks from closing modal
            document.querySelector('.video-modal-content').addEventListener('click', (e) => {
                e.stopPropagation();
            });
        </script>
        {{{google_analytics}}}
    </div>
</body>

</html>